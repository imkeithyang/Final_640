% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Exploring Difference in Difference Estimator Behavior Under Different Settings},
  pdfauthor={Zheyuan Liu, Haoming Yang},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Exploring Difference in Difference Estimator Behavior Under
Different Settings}
\author{Zheyuan Liu, Haoming Yang}
\date{4/16/2022}

\begin{document}
\maketitle

\hypertarget{simulation}{%
\section{Simulation}\label{simulation}}

\hypertarget{simulate-binary-outcome}{%
\subsection{Simulate Binary Outcome}\label{simulate-binary-outcome}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{inverse\_logit }\OtherTok{=} \ControlFlowTok{function}\NormalTok{(logit) \{}
  \FunctionTok{return}\NormalTok{ (}\FunctionTok{exp}\NormalTok{(logit)}\SpecialCharTok{/}\NormalTok{(}\DecValTok{1}\SpecialCharTok{+}\FunctionTok{exp}\NormalTok{(logit)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\[
\begin{gather*}
Y \sim Bernoulli (p) \\
l = \alpha + \gamma G + \delta_t t + \tau D + \beta x + \epsilon \\
p = \frac{e^{l}}{1+e^{l}}
\end{gather*}
\]

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Binary Timepoint}
\NormalTok{t }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\CommentTok{\# Binaray Treatment}
\NormalTok{treatment }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{n\_control }\OtherTok{=} \DecValTok{1000}
\NormalTok{n\_treat }\OtherTok{=} \DecValTok{300}

\CommentTok{\# Simulate X}
\NormalTok{x\_binary }\OtherTok{=} \FunctionTok{list}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(n\_control, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\FunctionTok{rnorm}\NormalTok{(n\_treat, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{))}

\CommentTok{\# Simulate coefficients}
\NormalTok{alpha\_binary }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{gamma\_binary }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{delta\_t\_binary }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{tau\_binary }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{beta\_binary }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
 
\CommentTok{\# Simulate logit l }
\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_control, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{logit\_before\_untreat }\OtherTok{=}\NormalTok{ alpha\_binary }\SpecialCharTok{+}\NormalTok{ gamma\_binary}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_binary}\SpecialCharTok{*}\NormalTok{x\_binary[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_treat, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{logit\_before\_treat }\OtherTok{=}\NormalTok{ alpha\_binary }\SpecialCharTok{+}\NormalTok{ gamma\_binary}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_binary}\SpecialCharTok{*}\NormalTok{x\_binary[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_control, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{logit\_after\_untreat }\OtherTok{=}\NormalTok{ alpha\_binary }\SpecialCharTok{+}\NormalTok{ gamma\_binary}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_binary}\SpecialCharTok{*}\NormalTok{x\_binary[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_treat, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{logit\_after\_treat }\OtherTok{=}\NormalTok{ alpha\_binary }\SpecialCharTok{+}\NormalTok{ gamma\_binary}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_binary}\SpecialCharTok{*}\NormalTok{x\_binary[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\CommentTok{\# No tau term because treatment = 0 for both groups}
\CommentTok{\# simulate parallel trend}
\NormalTok{logit\_after\_treat\_para }\OtherTok{=}\NormalTok{ alpha\_binary }\SpecialCharTok{+}\NormalTok{ gamma\_binary}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_binary}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}
\NormalTok{  beta\_binary}\SpecialCharTok{*}\NormalTok{x\_binary[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# visualization}
\NormalTok{df\_logit }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{treatment =} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_treat)),}
                      \AttributeTok{logit\_before =} \FunctionTok{c}\NormalTok{(logit\_before\_untreat, logit\_before\_treat),}
                      \AttributeTok{logit\_after =} \FunctionTok{c}\NormalTok{(logit\_after\_untreat, logit\_after\_treat))}

\FunctionTok{ggplot}\NormalTok{(df\_logit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{logit\_before, }\AttributeTok{color=}\FunctionTok{factor}\NormalTok{(treatment))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{logit\_after))}\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"black"}\NormalTok{, }\StringTok{"red"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{final_project_files/figure-latex/unnamed-chunk-3-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_avg\_logit }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{t =}\NormalTok{ t,}
                          \AttributeTok{logit\_untreat =} \FunctionTok{c}\NormalTok{(}\FunctionTok{mean}\NormalTok{(logit\_before\_untreat), }\FunctionTok{mean}\NormalTok{(logit\_after\_untreat)), }
                          \AttributeTok{logit\_treat =} \FunctionTok{c}\NormalTok{(}\FunctionTok{mean}\NormalTok{(logit\_before\_treat), }\FunctionTok{mean}\NormalTok{(logit\_after\_treat)),}
                          \AttributeTok{logit\_treat\_para =} \FunctionTok{c}\NormalTok{(}\FunctionTok{mean}\NormalTok{(logit\_before\_treat), }\FunctionTok{mean}\NormalTok{(logit\_after\_treat\_para)))}
\FunctionTok{ggplot}\NormalTok{(df\_avg\_logit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ t))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{logit\_untreat)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{logit\_untreat)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{logit\_treat), }\AttributeTok{color=}\StringTok{"red"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{logit\_treat), }\AttributeTok{color=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_line}\NormalTok{((}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{logit\_treat\_para)), }\AttributeTok{linetype=}\StringTok{"dashed"}\NormalTok{, }\AttributeTok{color=}\StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{logit\_treat\_para), }\AttributeTok{color=}\StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{final_project_files/figure-latex/unnamed-chunk-3-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# simulate binary outcome}
\NormalTok{y\_binary\_before }\OtherTok{=} \FunctionTok{rbinom}\NormalTok{(n\_control }\SpecialCharTok{+}\NormalTok{ n\_treat, }\DecValTok{1}\NormalTok{, }\FunctionTok{inverse\_logit}\NormalTok{(}\FunctionTok{c}\NormalTok{(logit\_before\_untreat, logit\_before\_treat)))}
\NormalTok{y\_binary\_after }\OtherTok{=} \FunctionTok{rbinom}\NormalTok{(n\_control }\SpecialCharTok{+}\NormalTok{ n\_treat, }\DecValTok{1}\NormalTok{, }\FunctionTok{inverse\_logit}\NormalTok{(}\FunctionTok{c}\NormalTok{(logit\_after\_untreat, logit\_after\_treat)))}

\NormalTok{df\_y\_logit }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{treatment =} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_treat), }\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_treat)),}
                        \AttributeTok{time\_point =} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control}\SpecialCharTok{+}\NormalTok{n\_treat), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_control}\SpecialCharTok{+}\NormalTok{n\_treat)),}
                        \AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(x\_binary), }\FunctionTok{unlist}\NormalTok{(x\_binary)),}
                        \AttributeTok{outcome =} \FunctionTok{c}\NormalTok{(y\_binary\_before, y\_binary\_after))}
\end{Highlighting}
\end{Shaded}

\hypertarget{simulate-count-poisson-outcome}{%
\subsection{Simulate Count (Poisson)
Outcome}\label{simulate-count-poisson-outcome}}

\[
\begin{gather*}
Y \sim Poisson (\lambda) \\
\log(\lambda) = \alpha + \gamma G + \delta_t t + \tau D + \beta x + \epsilon \\
\end{gather*}
\]

To simulate outcome, we take the modeled log lambda and sample from
Poisson distribution

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Binary Timepoint}
\NormalTok{t }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\CommentTok{\# Binary Treatment}
\NormalTok{treatment }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{n\_control }\OtherTok{=} \DecValTok{1000}
\NormalTok{n\_treat }\OtherTok{=} \DecValTok{300}

\CommentTok{\# simulate X}
\NormalTok{x\_poisson }\OtherTok{=} \FunctionTok{list}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(n\_control, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\FunctionTok{rnorm}\NormalTok{(n\_treat, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{))}

\CommentTok{\# simulate coefficient}
\NormalTok{alpha\_poisson }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{gamma\_poisson }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{delta\_t\_poisson }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{tau\_poisson }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{beta\_poisson }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}

\CommentTok{\# simulation count}
\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_control, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{lambda\_before\_untreat }\OtherTok{=}\NormalTok{ alpha\_poisson }\SpecialCharTok{+}\NormalTok{ gamma\_poisson}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_poisson}\SpecialCharTok{*}\NormalTok{x\_poisson[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_treat, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{lambda\_before\_treat }\OtherTok{=}\NormalTok{ alpha\_poisson }\SpecialCharTok{+}\NormalTok{ gamma\_poisson}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_poisson}\SpecialCharTok{*}\NormalTok{x\_poisson[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_control, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{lambda\_after\_untreat }\OtherTok{=}\NormalTok{ alpha\_poisson }\SpecialCharTok{+}\NormalTok{ gamma\_poisson}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_poisson}\SpecialCharTok{*}\NormalTok{x\_poisson[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\NormalTok{error }\OtherTok{=} \FunctionTok{rnorm}\NormalTok{(n\_treat, }\DecValTok{0}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\NormalTok{lambda\_after\_treat }\OtherTok{=}\NormalTok{ alpha\_poisson }\SpecialCharTok{+}\NormalTok{ gamma\_poisson}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+} 
\NormalTok{  tau\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{]}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ beta\_poisson}\SpecialCharTok{*}\NormalTok{x\_poisson[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}

\NormalTok{lambda\_after\_treat\_para }\OtherTok{=}\NormalTok{ alpha\_poisson }\SpecialCharTok{+}\NormalTok{ gamma\_poisson}\SpecialCharTok{*}\NormalTok{treatment[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ delta\_t\_poisson}\SpecialCharTok{*}\NormalTok{t[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}
\NormalTok{  beta\_poisson}\SpecialCharTok{*}\NormalTok{x\_poisson[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{+}\NormalTok{ error}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# visualization}
\NormalTok{df\_lambda }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{treatment =} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_treat)),}
                      \AttributeTok{lambda\_before =} \FunctionTok{c}\NormalTok{(lambda\_before\_untreat, lambda\_before\_treat),}
                      \AttributeTok{lambda\_after =} \FunctionTok{c}\NormalTok{(lambda\_after\_untreat, lambda\_after\_treat))}

\FunctionTok{ggplot}\NormalTok{(df\_lambda, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{lambda\_before, }\AttributeTok{color=}\FunctionTok{factor}\NormalTok{(treatment))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{lambda\_after)) }\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"black"}\NormalTok{, }\StringTok{"red"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{final_project_files/figure-latex/unnamed-chunk-6-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_avg\_lambda }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{t =}\NormalTok{ t,}
                          \AttributeTok{lambda\_untreat =} \FunctionTok{c}\NormalTok{(}\FunctionTok{mean}\NormalTok{(lambda\_before\_untreat), }\FunctionTok{mean}\NormalTok{(lambda\_after\_untreat)), }
                          \AttributeTok{lambda\_treat =} \FunctionTok{c}\NormalTok{(}\FunctionTok{mean}\NormalTok{(lambda\_before\_treat), }\FunctionTok{mean}\NormalTok{(lambda\_after\_treat)),}
                          \AttributeTok{lambda\_treat\_para =} \FunctionTok{c}\NormalTok{(}\FunctionTok{mean}\NormalTok{(lambda\_before\_treat), }\FunctionTok{mean}\NormalTok{(lambda\_after\_treat\_para)))}
\FunctionTok{ggplot}\NormalTok{(df\_avg\_lambda, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ t))}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{lambda\_untreat)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{lambda\_untreat)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{lambda\_treat), }\AttributeTok{color=}\StringTok{"red"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{lambda\_treat), }\AttributeTok{color=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_line}\NormalTok{((}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{lambda\_treat\_para)), }\AttributeTok{linetype=}\StringTok{"dashed"}\NormalTok{, }\AttributeTok{color=}\StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{lambda\_treat\_para), }\AttributeTok{color=}\StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{final_project_files/figure-latex/unnamed-chunk-6-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# simulate count outcome}
\NormalTok{y\_poisson\_before }\OtherTok{=} \FunctionTok{rpois}\NormalTok{(n\_control }\SpecialCharTok{+}\NormalTok{ n\_treat, }\FunctionTok{exp}\NormalTok{(}\FunctionTok{c}\NormalTok{(lambda\_before\_untreat, lambda\_before\_treat)))}
\NormalTok{y\_poisson\_after }\OtherTok{=} \FunctionTok{rpois}\NormalTok{(n\_control }\SpecialCharTok{+}\NormalTok{ n\_treat, }\FunctionTok{exp}\NormalTok{(}\FunctionTok{c}\NormalTok{(lambda\_after\_untreat, lambda\_after\_treat)))}

\NormalTok{df\_y\_poisson }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{treatment =} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_treat), }\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_treat)),}
                        \AttributeTok{time\_point =} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n\_control}\SpecialCharTok{+}\NormalTok{n\_treat), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n\_control}\SpecialCharTok{+}\NormalTok{n\_treat)),}
                        \AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(x\_poisson), }\FunctionTok{unlist}\NormalTok{(x\_poisson)),}
                        \AttributeTok{outcome =} \FunctionTok{c}\NormalTok{(y\_poisson\_before, y\_poisson\_after))}
\end{Highlighting}
\end{Shaded}

\hypertarget{card-and-krugers-parallel-trend-assumption}{%
\section{Card and Kruger's Parallel Trend
Assumption}\label{card-and-krugers-parallel-trend-assumption}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{read\_table2}\NormalTok{(}\StringTok{\textquotesingle{}public.dat\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## -- Column specification --------------------------------------------------------
## cols(
##   .default = col_character(),
##   `46` = col_double(),
##   `1` = col_double(),
##   `0` = col_double(),
##   `0_1` = col_double(),
##   `0_2` = col_double(),
##   `0_3` = col_double(),
##   `0_4` = col_double(),
##   `1_1` = col_double(),
##   `0_5` = col_double(),
##   `0_6` = col_double(),
##   `0_7` = col_double(),
##   `1_2` = col_double(),
##   `2` = col_double(),
##   `6.50` = col_double(),
##   `16.50` = col_double(),
##   `1_3` = col_double(),
##   `1_4` = col_double(),
##   `111792` = col_double(),
##   X47 = col_logical()
## )
## i Use `spec()` for the full column specifications.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{codebook }\OtherTok{\textless{}{-}} \FunctionTok{read\_lines}\NormalTok{(}\AttributeTok{file =} \StringTok{"codebook"}\NormalTok{)}

\CommentTok{\# extract variable name}
\NormalTok{variable\_names }\OtherTok{\textless{}{-}}\NormalTok{ codebook }\SpecialCharTok{\%\textgreater{}\%}
  \StringTok{\textasciigrave{}}\AttributeTok{[}\StringTok{\textasciigrave{}}\NormalTok{(}\DecValTok{8}\SpecialCharTok{:}\DecValTok{59}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \StringTok{\textasciigrave{}}\AttributeTok{[}\StringTok{\textasciigrave{}}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{13}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{32}\NormalTok{, }\DecValTok{33}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{str\_sub}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{13}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{str\_squish}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{str\_to\_lower}\NormalTok{()}


\CommentTok{\# match with raw data}
\NormalTok{dat }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{X47) }\SpecialCharTok{\%\textgreater{}\%}
  \StringTok{\textasciigrave{}}\AttributeTok{colnames\textless{}{-}}\StringTok{\textasciigrave{}}\NormalTok{(., variable\_names) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate\_all}\NormalTok{(as.numeric) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sheet =} \FunctionTok{as.character}\NormalTok{(sheet))}


\CommentTok{\# compare before and after outcome}
\NormalTok{dat }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(state) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fte=}\NormalTok{empft}\SpecialCharTok{+}\NormalTok{nmgrs}\SpecialCharTok{+}\NormalTok{(}\FloatTok{0.5}\SpecialCharTok{*}\NormalTok{emppt),}
         \AttributeTok{fte\_after=}\NormalTok{empft2}\SpecialCharTok{+}\NormalTok{nmgrs2}\SpecialCharTok{+}\NormalTok{(}\FloatTok{0.5}\SpecialCharTok{*}\NormalTok{emppt2)) }


\NormalTok{summary }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(state) }\SpecialCharTok{\%\textgreater{}\%} 
            \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean\_before=}\FunctionTok{mean}\NormalTok{(fte,}\AttributeTok{na.rm=}\NormalTok{T),}
                      \AttributeTok{mean\_after=}\FunctionTok{mean}\NormalTok{(fte\_after,}\AttributeTok{na.rm=}\NormalTok{T),}
                      \AttributeTok{var\_before=}\FunctionTok{var}\NormalTok{(fte,}\AttributeTok{na.rm=}\NormalTok{T),}
                      \AttributeTok{var\_after=}\FunctionTok{var}\NormalTok{(fte\_after,}\AttributeTok{na.rm=}\NormalTok{T),}
                      \AttributeTok{count\_before=}\FunctionTok{sum}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(fte)),}
                      \AttributeTok{count\_after=}\FunctionTok{sum}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(fte\_after))) }\SpecialCharTok{\%\textgreater{}\%}
           \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
           \FunctionTok{mutate}\NormalTok{(}\AttributeTok{se\_before=}\FunctionTok{sqrt}\NormalTok{(var\_before}\SpecialCharTok{/}\NormalTok{count\_before),}
                  \AttributeTok{se\_after=}\FunctionTok{sqrt}\NormalTok{(var\_after}\SpecialCharTok{/}\NormalTok{count\_after)) }\SpecialCharTok{\%\textgreater{}\%}
          \FunctionTok{mutate}\NormalTok{(}\AttributeTok{state=}\FunctionTok{ifelse}\NormalTok{(state}\SpecialCharTok{==}\DecValTok{0}\NormalTok{,}\StringTok{"PA"}\NormalTok{,}\StringTok{"NJ"}\NormalTok{)) }


\CommentTok{\# treatment and control average unemployment}
\NormalTok{plot\_df }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(state) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean\_before=}\FunctionTok{mean}\NormalTok{(fte,}\AttributeTok{na.rm=}\NormalTok{T),}
            \AttributeTok{mean\_after=}\FunctionTok{mean}\NormalTok{(fte\_after,}\AttributeTok{na.rm=}\NormalTok{T)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{state =} \FunctionTok{ifelse}\NormalTok{(state }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\StringTok{"PA"}\NormalTok{, }\StringTok{"NJ"}\NormalTok{)) }

\CommentTok{\# wide to long format }
\NormalTok{plot\_df\_2 }\OtherTok{\textless{}{-}} \FunctionTok{gather}\NormalTok{(plot\_df, }
\NormalTok{                    time, }
\NormalTok{                    obs\_unemployment, }
\NormalTok{                    mean\_before}\SpecialCharTok{:}\NormalTok{mean\_after, }
                    \AttributeTok{factor\_key =} \ConstantTok{TRUE}\NormalTok{) }

\CommentTok{\# impute counterfactual unemployment average on the treated }
\NormalTok{y\_counterfactual }\OtherTok{=}\NormalTok{ plot\_df\_2[}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ plot\_df\_2[}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ plot\_df\_2[}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{]}

\NormalTok{plot\_df\_2 }\OtherTok{\textless{}{-}}\NormalTok{ plot\_df\_2 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{time =} \FunctionTok{ifelse}\NormalTok{(time }\SpecialCharTok{==} \StringTok{\textquotesingle{}mean\_before\textquotesingle{}}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{))}

\NormalTok{plot\_df\_2}\SpecialCharTok{$}\NormalTok{diff\_unemploy }\OtherTok{\textless{}{-}}\NormalTok{ plot\_df\_2}\SpecialCharTok{$}\NormalTok{obs\_unemployment}
\NormalTok{plot\_df\_2[}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ y\_counterfactual[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{]}


\CommentTok{\# plot parallel trend asssumption }
\FunctionTok{ggplot}\NormalTok{(plot\_df\_2) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ time, }\AttributeTok{y =}\NormalTok{ obs\_unemployment, }\AttributeTok{linetype =}\NormalTok{ state)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ time, }\AttributeTok{y =}\NormalTok{ diff\_unemploy, }\AttributeTok{linetype =}\NormalTok{ state)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Minimum Wage Observed Effect and Counterfactual Effect on NJ and PA "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{final_project_files/figure-latex/unnamed-chunk-8-1.pdf}

\hypertarget{regression-perspective}{%
\section{Regression Perspective}\label{regression-perspective}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat\_regression }\OtherTok{\textless{}{-}} \FunctionTok{gather}\NormalTok{(dat, }
\NormalTok{                    time, }
\NormalTok{                    unemployment, }
\NormalTok{                    fte}\SpecialCharTok{:}\NormalTok{fte\_after, }
                    \AttributeTok{factor\_key =} \ConstantTok{TRUE}\NormalTok{) }

\NormalTok{dat\_regression }\OtherTok{\textless{}{-}}\NormalTok{ dat\_regression }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{time =} \FunctionTok{ifelse}\NormalTok{(time }\SpecialCharTok{==} \StringTok{\textquotesingle{}fte\textquotesingle{}}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(state, time, unemployment)}


\CommentTok{\# fitting linear regression }
\end{Highlighting}
\end{Shaded}

\hypertarget{poisson-regression}{%
\section{Poisson Regression}\label{poisson-regression}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson\_glm }\OtherTok{=} \FunctionTok{glm}\NormalTok{(outcome }\SpecialCharTok{\textasciitilde{}}\NormalTok{ treatment }\SpecialCharTok{+}\NormalTok{ time\_point }\SpecialCharTok{+}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ treatment}\SpecialCharTok{:}\NormalTok{time\_point, }
                  \AttributeTok{data=}\NormalTok{df\_y\_poisson, }\AttributeTok{family=}\StringTok{"poisson"}\NormalTok{)}
\NormalTok{poisson\_true\_parameter }\OtherTok{=} \FunctionTok{c}\NormalTok{(alpha\_poisson, gamma\_poisson, delta\_t\_poisson, beta\_poisson, tau\_poisson)}
\NormalTok{poisson\_true\_parameter}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  0.8296408 -1.6476442 -0.1710695  1.5312592  1.0564863
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson\_glm}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          (Intercept)            treatment           time_point 
##            0.8492662           -1.6227171           -0.1659105 
##                    x treatment:time_point 
##            1.5252846            0.9680914
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{exp}\NormalTok{(poisson\_glm}\SpecialCharTok{$}\NormalTok{coefficients[}\DecValTok{5}\NormalTok{]) }\SpecialCharTok{{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## treatment:time_point 
##             1.632915
\end{verbatim}

\end{document}
